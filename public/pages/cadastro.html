<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro</title>
    <link rel="stylesheet" href="../style/cadastro.css">
    <link rel="icon" href="../img/logo.svg" type="image/svg+xml">

</head>

<body>
    <div class="inicio">
        <div class="container">
            <div class="left-container">

                <h1>Cadastre-se</h1>

                <div class="Caixa-de-entrada">

                    <h4>Nome Completo</h4>
                    <input id="iptName" type="text" placeholder="Insira seu nome">
                    <h4>Email</h4>
                    <input id="iptEmail" type="email" placeholder="Insira seu email"> <br>
                    <h4>Senha</h4>
                    <input id="iptSenha" type="password" placeholder="Senha"> <br>
                    <h4>Quantos gatinhos você tem?</h4>
                    <input id="iptGato" type="number" placeholder="Insira um número">
                    <div class="select">
                        <h4>Qual seu Sexo?</h4>
                        <select name="" id="sexo">
                            <option value=""> Selecione </option>
                            <option value="Feminino">Feminino</option>
                            <option value="Masculino">Masculino</option>
                            <option value="outro"> Prefiro não informar</option>
                        </select>
                    </div>
                    <h4>Qual sua data de nascimento? </h4>
                    <input id="iptDtNasc" type="date" placeholder="Insira sua idade">
                    <p> Já tem uma conta? <a href="./login.html"> Login </a> </p>
                    <button class="button" onclick="cadastrarUsuario()"> Cadastrar </button>
                </div>

            </div>
            <div class="right-container">
                <h1>Bem Vindo(a)!</h1>
                <h3> A Cat Journal</h3>
            </div>

            <p id="mensagem" class="mensagem"></p>

<script>


function cadastrarUsuario() {
    console.log("Iniciando cadastro...");

    var nomeValor = iptName.value;
    var emailValor = iptEmail.value;
    var senhaValor = iptSenha.value;
    var qtdGatoValor = iptGato.value;
    var sexoValor = sexo.value;
    var dtNascValor = iptDtNasc.value;
        
  

    fetch("/users/cadastrar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            nome: nomeValor,
            email: emailValor,
            senha: senhaValor,
            qtdGato: qtdGatoValor,
            sexo: sexoValor,
            dtNasc: dtNascValor
        })
    })
    .then(resposta => resposta.json().then(data => ({ status: resposta.status, body: data })))
    .then(result => {
        const status = result.status;
        const dados = result.body;

        // Sucesso
        if (status === 201) {
            mensagem.innerHTML = `Cadastro realizado com sucesso! Bem-vindo(a), ${nomeValor}!`;

            setTimeout(() => {
                window.location.href = "./login.html";
            }, 1500);

        // Email já cadastrado
        } else if (status === 409) {
            mensagem.innerHTML = "Este e-mail já está cadastrado. Tente outro ou faça login.";

        // Outros erros
        } else {
            mensagem.innerHTML = dados.message || "Erro ao cadastrar usuário.";
            
        }
    })
    .catch(erro => {
        mensagem.innerHTML = "Erro ao conectar com o servidor. Verifique se a API está rodando.";
        console.error("Erro:", erro);
    });
}

const usuario = JSON.parse(sessionStorage.getItem("usuario"));




</script>

</body>

</html>