<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../assets/img/cat-solid-full (1).svg" type="image/svg+xml">
    <link rel="stylesheet" href="../style/login.css">

    <title>Login</title>
</head>

<body>
    <div class="main">
        <div class="container">
            <div class="left-container">
                <h1>Que bom ter você de volta!</h1>
                <h3> A Cat Journal sentiu sua falta</h3>
            </div>
            <div class="right-container">
                <h1>Login</h1>

                <div class="Caixa-de-entrada">

                    <h4>Email</h4>
                    <input id="iptEmail" type="email" placeholder="Email"> <br>

                    <h4>Senha</h4>
                    <input id="iptSenha" type="password" placeholder="Senha"> <br>

                    <button onclick="fazerLogin()" class="button" type="button"> Login </button>
                </div>

                <div>
                    <p> Não tem uma conta? <br>
                        <a href="./Cadastro.html"> Cadastre-se </a>
                    </p>
                </div>
            </div>
            <p id="mensagem" class="mensagem"></p>

<script>
    function fazerLogin() {
        var emailValor = iptEmail.value;
        var senhaValor = iptSenha.value;

        fetch("/users/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                email: emailValor,
                senha: senhaValor
            })
        })
            .then(res => res.json().then(dados => ({ status: res.status, dados })))
            .then(retorno => {
                var status = retorno.status;
                var dados = retorno.dados;

            
                var usuario = dados.data?.[0];

                if (status === 200 && usuario) {

                    mensagem.innerHTML = `Bem-vindo(a), ${usuario.nome}!`;

                    // salvar usuário
                    sessionStorage.setItem("usuario", JSON.stringify(usuario));

                    if (status === 200 && usuario.papelUsuario === "admin") {
                         setTimeout(function () {
                        window.location = "./dashboard.html";;
                    }, 1000);
                        
                    } else {
                       setTimeout(function () {
                        window.location = "./preQuiz.html";
                    }, 1000);
                       
                    }

                } else {
                    mensagem.innerHTML = dados.message;
                   
                }
            })
            .catch(erro => {
                mensagem.innerHTML = "Erro ao conectar com o servidor.";
                console.error(erro);
            });
    }
</script>



</body>

</html>